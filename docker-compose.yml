version: '3'
services:
  traefik:
    image: traefik:1.7
    restart: always
    ports:
      - 80:80
      - 443:443
      # - 8080:8080  # Traefik Dashboard
    environment:
      # Cloudflare example shown
      CLOUDFLARE_EMAIL: test@example.com
      CLOUDFLARE_API_KEY: 1234567890abcdefghijklmnopqrstuv
    depends_on:
      - openvas
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ./traefik:/traefik
    container_name: traefik
  openvas:
      restart: always
      image: mikesplain/openvas
      hostname: openvas
      expose:
        - "443"
      volumes:
        - "./data/openvas:/var/lib/openvas/mgr/"
      environment:
        OV_PASSWORD: 'abcdefghi12345' # CHANGE THIS !
        # PUBLIC_HOSTNAME: test.example.com
        # OV_SMTP_HOSTNAME: smtp.example.com
        # OV_SMTP_PORT: 587
        # OV_SMTP_USERNAME: 'text@example.com'
        # OV_SMTP_KEY: 'testuserp@assw0rd!'
      labels:
        deck-chores.dump.command: sh -c "greenbone-nvt-sync; openvasmd --rebuild --progress"
        deck-chores.dump.interval: daily
        traefik.backend: openvas
        traefik.enable: true
        traefik.frontend.entryPoints: http,https
        traefik.frontend.rule: Host:text.example.com # Change this to your OpenVAS FQDN
        traefik.port: 443
        traefik.protocol: https
      container_name: openvas
  # Daily updates to openvas
  cron:
      restart: always
      image: funkyfuture/deck-chores
      volumes:
        - "/var/run/docker.sock:/var/run/docker.sock"
